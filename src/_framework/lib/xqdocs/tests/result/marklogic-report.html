<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>MarkLogic xquerydoc Unit Tests</title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .result {
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          }
          .footer {
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          .result h3 {
          font-weight: normal;
          font-size: inherit;
          margin: 0;
          }
          .result.fail h3 {
          color: red;
          }
          .pass {
          border-color: green;
          }
          .fail {
          border-color: red;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }
          h2+div.stats {
          display: inline-block;
          margin-left: 1em;
          }
          strong.fail, 
          h2.fail {
          border: none;
          color: red;
          }
          h2.fail:before {
          content: "✘ ";
          }
          h2.pass:before {
          content: "✔ ";
          }
          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          .fail .message {
          font-weight: bold;
          }
          .namespace {
          margin-left: 1em;
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="../../lib/prettify.js" type="text/javascript">  </script><script src="../../lib/lang-xq.js" type="text/javascript">  </script><link rel="stylesheet" type="text/css" href="../../lib/prettify.css"> </link></head><body onload="prettyPrint()"><h1>MarkLogic xquerydoc Unit Tests Results</h1><p><strong>0%
pass rate: 
</strong><strong class="fail">7</strong> failed tests and <strong>0</strong> passed tests.</p><h2> [ unit-test: /marklogic/simple.xqy ] [ example: /examples/default.xqy]<span style="font-size:75%;color:grey">simple</span></h2><ol class="results"><li class="result fail"><h3><input name="test" value="" type="checkbox"><b>ml1.</b></input><a href="?test=">default.xqy test<span class="namespace">ns: http://www.xqdoc.org/1.0</span></a><table><thead><th>expected  (/src/tests/expected/marklogic/default.xml)</th><th>actual </th></thead><tbody><tr><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><doc:xqdoc xmlns:doc="http://www.xqdoc.org/1.0"><doc:control><!--Generated by xquerydoc: http://github.com/xquery/xquerydoc--><doc:version>N/A</doc:version></doc:control><doc:module type="main"><doc:uri/><doc:comment><doc:description> &#xD;  This main module controls the presentation of the home page for&#xD;  xqDoc.  The home page will list all of the library and main modules&#xD;  contained in the 'xqDoc' collection.&#xD;  The mainline function invokes only the&#xD;  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;  real-time viewing.&#xD; &#xD;  </doc:description><doc:author> Darin McBeath&#xD;  </doc:author><doc:since> June 9, 2006&#xD;  </doc:since><doc:version> 1.3&#xD;</doc:version></doc:comment></doc:module><doc:variables/><doc:functions/></doc:xqdoc></textarea></pre></td><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><doc:xqdoc xmlns:doc="http://www.xqdoc.org/1.0"><doc:control><!--Generated by xquerydoc: http://github.com/xquery/xquerydoc--><doc:date/><doc:version>N/A</doc:version></doc:control><doc:module type="main"><doc:uri/><doc:comment><doc:description> &#xD;  This main module controls the presentation of the home page for&#xD;  xqDoc.  The home page will list all of the library and main modules&#xD;  contained in the 'xqDoc' collection.&#xD;  The mainline function invokes only the&#xD;  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;  real-time viewing.&#xD; &#xD;  </doc:description><doc:author> Darin McBeath&#xD;  </doc:author><doc:since> June 9, 2006&#xD;  </doc:since><doc:version> 1.3&#xD;</doc:version></doc:comment></doc:module><doc:variables/><doc:functions/></doc:xqdoc></textarea></pre></td></tr></tbody></table></h3><br/></li></ol><h2> [ unit-test: /marklogic/simple.xqy ] [ example: /examples/get-code.xqy]<span style="font-size:75%;color:grey">simple</span></h2><ol class="results"><li class="result fail"><h3><input name="test" value="" type="checkbox"><b>ml1.</b></input><a href="?test=">default.xqy test<span class="namespace">ns: http://www.xqdoc.org/1.0</span></a><table><thead><th>expected  (/src/tests/expected/marklogic/get-code.xml)</th><th>actual </th></thead><tbody><tr><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><doc:xqdoc xmlns:doc="http://www.xqdoc.org/1.0"><doc:control><!--Generated by xquerydoc: http://github.com/xquery/xquerydoc--><doc:version>N/A</doc:version></doc:control><doc:module type="main"><doc:uri/><doc:comment><doc:description> &#xD;  This main module controls the presentation of the code for either&#xD;  an entire mdoule or a particlur function within a module. &#xD;  The mainline function invokes only the&#xD;  method to retrieve the source code.  The 'module' and 'function' parameters&#xD;  are extracted from the query-string.  If only a 'module' is specified, then&#xD;  the source code for the entire module will be returned.  If both a 'module'&#xD;  and a 'function' are specified, only the source code for the specified function&#xD;  within the module will be returned. A parameter of type xs:boolean &#xD;  is passed to indicate whether links on the page should be constructed &#xD;  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;  real-time viewing.&#xD; &#xD;  </doc:description><doc:author> Darin McBeath&#xD;  </doc:author><doc:since> June 9, 2006&#xD;  </doc:since><doc:version> 1.3&#xD;</doc:version></doc:comment></doc:module><doc:variables/><doc:functions/></doc:xqdoc></textarea></pre></td><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><doc:xqdoc xmlns:doc="http://www.xqdoc.org/1.0"><doc:control><!--Generated by xquerydoc: http://github.com/xquery/xquerydoc--><doc:date/><doc:version>N/A</doc:version></doc:control><doc:module type="main"><doc:uri/><doc:comment><doc:description> &#xD;  This main module controls the presentation of the code for either&#xD;  an entire mdoule or a particlur function within a module. &#xD;  The mainline function invokes only the&#xD;  method to retrieve the source code.  The 'module' and 'function' parameters&#xD;  are extracted from the query-string.  If only a 'module' is specified, then&#xD;  the source code for the entire module will be returned.  If both a 'module'&#xD;  and a 'function' are specified, only the source code for the specified function&#xD;  within the module will be returned. A parameter of type xs:boolean &#xD;  is passed to indicate whether links on the page should be constructed &#xD;  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;  real-time viewing.&#xD; &#xD;  </doc:description><doc:author> Darin McBeath&#xD;  </doc:author><doc:since> June 9, 2006&#xD;  </doc:since><doc:version> 1.3&#xD;</doc:version></doc:comment></doc:module><doc:variables/><doc:functions/></doc:xqdoc></textarea></pre></td></tr></tbody></table></h3><br/></li></ol><h2> [ unit-test: /marklogic/output-html.xqy ] [ example: /examples/json.xqy]<span style="font-size:75%;color:grey">Output HTML</span></h2><ol class="results"><li class="result fail"><h3><input name="test" value="" type="checkbox"><b>ml2.</b></input><a href="?test=">output-html manually<span class="namespace">ns: http://www.w3.org/1999/xhtml</span></a><table><thead><th>expected  (/src/tests/expected/marklogic/json-html-output.xml)</th><th>actual </th></thead><tbody><tr><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><title>xqDoc - </title><style type="text/css" xml:space="preserve">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #99f;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 50%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="src/tests/result/resource/prettify.js" type="text/javascript" xml:space="preserve">  </script><script src="src/tests/result/resource/lang-xq.js" type="text/javascript" xml:space="preserve">  </script><link rel="stylesheet" type="text/css" href="src/tests/result/resource/prettify.css"> </link></head><body class="home"><div id="main"><h1><span class="namespace">http://marklogic.com/json</span>  library module </h1><h5>Comment</h5><p> This is an example xquery file taken from several files to demonstrate xqdoc commenting  Sample usage:    example bold tag     Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra  eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse  eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero.  Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet.  </p>
    Author:  Jim Fuller 
    v. 1  <h3>Variables</h3><ul><li>new-line-regex xs:string</li></ul><h3>Functions</h3><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>escape</u>($s as xs:string) as  xs:string</pre></h4><h5>Params</h5><ul><li>s:  xs:string</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>print-value</u>($x as element()) as  xs:string</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>print-name-value</u>($x as element()) as  xs:string?</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>serialize</u>($x as element()) as  xs:string</pre></h4><h5>Comment</h5><p> Transforms an XML element into a JSON string representation.  See http://json.org.  Sample usage:    xquery version "1.0-ml";   import module namespace json="http://marklogic.com/json" at "json.xqy";   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)  Sample transformations:  Namespace URIs are ignored.  Namespace prefixes are included in the JSON name. Attributes are ignored, except for the special attribute </p>="true" that indicates the JSON serialization should write the node, even if single, as an array, and the attribute  that can be set to "boolean" or "number" to dictate the value should be written as that type (unquoted).  There's also an  attribute that when set to true writes the inner content as text rather than as structured JSON, useful for sending some XHTML over the wire. Text nodes within mixed content are ignored.  $x Element node to convert  String holding JSON serialized representation of $x 
    Author:  Jason Hunter 
    v. 1.0.1  Ported to xquery 1.0-ml; double escaped backslashes in json:escape<h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h3>Original Source Code</h3><pre class="prettyprint lang-xq" xml:space="preserve">xquery version "1.0-ml";


(:~
 : This is an example xquery file taken from several files to demonstrate xqdoc commenting
 : 
 : Sample usage:
 : &lt;b&gt;
 :   example bold tag
 : &lt;/b&gt;  
  : 
 : Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra 
 : eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse 
 : eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero. 
 : Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus
 : et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet. 
 :
 :
 : @author Jim Fuller
 : @version 1
 : 
 : 
:)

module namespace json = "http://marklogic.com/json";
declare namespace test="test";

declare default function namespace "http://www.w3.org/2005/xpath-functions";

declare variable $new-line-regex as xs:string := concat('[',codepoints-to-string((13, 10)),']+');

(: Need to backslash escape any double quotes, backslashes, newlines and tabs :)
declare function json:escape($s as xs:string) as xs:string {
  let $s := replace($s, "(\\|"")", "\\$1")
  let $s := replace($s, $new-line-regex, "\\n")
  let $s := replace($s, codepoints-to-string(9), "\\t")
  return $s
};

(: Print the thing that comes after the colon :)
declare function json:print-value($x as element()) as xs:string {
  if (count($x/*) = 0) then
    json:atomize($x)
  else if ($x/@quote = "true") then
    concat('"', json:escape(xdmp:quote($x/node())), '"')
  else
    string-join(('{',
      string-join(for $i in $x/* return json:print-name-value($i), ","),
    '}'), "")
};

(: Print the name and value both :)
declare function json:print-name-value($x as element()) as xs:string? {
  let $name := name($x)
  let $later-in-array := some $s in $x/following-sibling::* satisfies name($s) = $name
  return
  if ($later-in-array) then
    ()
  else 
    ()
};

(:~
 : Transforms an XML element into a JSON string representation.  See http://json.org.
 : 
 : Sample usage:
 : &lt;pre&gt;
 :   xquery version "1.0-ml";
 :   import module namespace json="http://marklogic.com/json" at "json.xqy";
 :   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)
 : &lt;/pre&gt;
 : Sample transformations:
 : 
 : Namespace URIs are ignored.  Namespace prefixes are included in the JSON name.
 :
 : Attributes are ignored, except for the special attribute @array="true" that
 : indicates the JSON serialization should write the node, even if single, as an
 : array, and the attribute @type that can be set to "boolean" or "number" to
 : dictate the value should be written as that type (unquoted).  There's also
 : an @quote attribute that when set to true writes the inner content as text
 : rather than as structured JSON, useful for sending some XHTML over the
 : wire.
 :
 : Text nodes within mixed content are ignored.
 :
 : @param $x Element node to convert
 : @return String holding JSON serialized representation of $x
 :
 : @author Jason Hunter
 : @version 1.0.1
 : 
 : Ported to xquery 1.0-ml; double escaped backslashes in json:escape
:)
declare function json:serialize($x as element())  as xs:string {
  string-join(('{', json:print-name-value($x), '}'), "")
};

</pre><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript" xml:space="preserve">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Generator" content="xquerydoc - https://github.com/xquery/xquerydoc"/><meta http-equiv="Authors" content="Copyright 2011 - John Snelson, James Fuller"/><title>xqDoc - </title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #000;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 90%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="lib/prettify.js" type="lib/javascript">  </script><script src="lib/lang-xq.js" type="text/javascript">  </script><link rel="stylesheet" type="text/css" href="lib/prettify.css"> </link></head><body class="home"><a href="index.html">XQuery API index</a><div id="main"><h1><span class="namespace">http://marklogic.com/json</span>  library module </h1><h5>Description</h5><p>This is an example xquery file taken from several files to demonstrate xqdoc commenting Sample usage:example bold tagProin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero. Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet.</p>
    Author:  Jim Fuller 
    v. 1  <div><h3>Variables</h3><ul><li>new-line-regexxs:string</li></ul></div><div><h3>Functions</h3><h4><pre class="prettyprint lang-xq"><u>Function:</u> escape($s as xs:string) as  xs:string</pre></h4><h5>Params</h5><ul><li>s:  xs:string</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> print-value($x as element()) as  xs:string</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> print-name-value($x as element()) as  xs:string?</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> serialize($x as element()) as  xs:string</pre></h4><h5>Description</h5><p>Transforms an XML element into a JSON string representation. See http://json.org. Sample usage:xquery version "1.0-ml"; import module namespace json="http://marklogic.com/json" at "json.xqy"; json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)Sample transformations: Namespace URIs are ignored. Namespace prefixes are included in the JSON name. Attributes are ignored, except for the special attribute</p>="true" that indicates the JSON serialization should write the node, even if single, as an array, and the attribute  that can be set to "boolean" or "number" to dictate the value should be written as that type (unquoted).  There's also an  attribute that when set to true writes the inner content as text rather than as structured JSON, useful for sending some XHTML over the wire. Text nodes within mixed content are ignored. $x Element node to convert String holding JSON serialized representation of $x 
    Author:  Jason Hunter 
    v. 1.0.1  Ported to xquery 1.0-ml; double escaped backslashes in json:escape<h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul></div><div><h3>Original Source Code</h3><pre class="prettyprint lang-xq">xquery version "1.0-ml";


(:~
 : This is an example xquery file taken from several files to demonstrate xqdoc commenting
 : 
 : Sample usage:
 : &lt;b&gt;
 :   example bold tag
 : &lt;/b&gt;  
  : 
 : Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra 
 : eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse 
 : eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero. 
 : Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus
 : et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet. 
 :
 :
 : @author Jim Fuller
 : @version 1
 : 
 : 
:)

module namespace json = "http://marklogic.com/json";
declare namespace test="test";

declare default function namespace "http://www.w3.org/2005/xpath-functions";

declare variable $new-line-regex as xs:string := concat('[',codepoints-to-string((13, 10)),']+');

(: Need to backslash escape any double quotes, backslashes, newlines and tabs :)
declare function json:escape($s as xs:string) as xs:string {
  let $s := replace($s, "(\\|"")", "\\$1")
  let $s := replace($s, $new-line-regex, "\\n")
  let $s := replace($s, codepoints-to-string(9), "\\t")
  return $s
};

(: Print the thing that comes after the colon :)
declare function json:print-value($x as element()) as xs:string {
  if (count($x/*) = 0) then
    json:atomize($x)
  else if ($x/@quote = "true") then
    concat('"', json:escape(xdmp:quote($x/node())), '"')
  else
    string-join(('{',
      string-join(for $i in $x/* return json:print-name-value($i), ","),
    '}'), "")
};

(: Print the name and value both :)
declare function json:print-name-value($x as element()) as xs:string? {
  let $name := name($x)
  let $later-in-array := some $s in $x/following-sibling::* satisfies name($s) = $name
  return
  if ($later-in-array) then
    ()
  else 
    ()
};

(:~
 : Transforms an XML element into a JSON string representation.  See http://json.org.
 : 
 : Sample usage:
 : &lt;pre&gt;
 :   xquery version "1.0-ml";
 :   import module namespace json="http://marklogic.com/json" at "json.xqy";
 :   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)
 : &lt;/pre&gt;
 : Sample transformations:
 : 
 : Namespace URIs are ignored.  Namespace prefixes are included in the JSON name.
 :
 : Attributes are ignored, except for the special attribute @array="true" that
 : indicates the JSON serialization should write the node, even if single, as an
 : array, and the attribute @type that can be set to "boolean" or "number" to
 : dictate the value should be written as that type (unquoted).  There's also
 : an @quote attribute that when set to true writes the inner content as text
 : rather than as structured JSON, useful for sending some XHTML over the
 : wire.
 :
 : Text nodes within mixed content are ignored.
 :
 : @param $x Element node to convert
 : @return String holding JSON serialized representation of $x
 :
 : @author Jason Hunter
 : @version 1.0.1
 : 
 : Ported to xquery 1.0-ml; double escaped backslashes in json:escape
:)
declare function json:serialize($x as element())  as xs:string {
  string-join(('{', json:print-name-value($x), '}'), "")
};

</pre></div><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td></tr></tbody></table></h3><br/></li><li class="result fail"><h3><input name="test" value="" type="checkbox"><b>ml3.</b></input><a href="?test=">output-html with xqdoc:generate-docs<span class="namespace">ns: http://www.w3.org/1999/xhtml</span></a><table><thead><th>expected  (/src/tests/expected/marklogic/json-html-output.xml)</th><th>actual </th></thead><tbody><tr><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><title>xqDoc - </title><style type="text/css" xml:space="preserve">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #99f;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 50%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="src/tests/result/resource/prettify.js" type="text/javascript" xml:space="preserve">  </script><script src="src/tests/result/resource/lang-xq.js" type="text/javascript" xml:space="preserve">  </script><link rel="stylesheet" type="text/css" href="src/tests/result/resource/prettify.css"> </link></head><body class="home"><div id="main"><h1><span class="namespace">http://marklogic.com/json</span>  library module </h1><h5>Comment</h5><p> This is an example xquery file taken from several files to demonstrate xqdoc commenting  Sample usage:    example bold tag     Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra  eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse  eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero.  Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet.  </p>
    Author:  Jim Fuller 
    v. 1  <h3>Variables</h3><ul><li>new-line-regex xs:string</li></ul><h3>Functions</h3><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>escape</u>($s as xs:string) as  xs:string</pre></h4><h5>Params</h5><ul><li>s:  xs:string</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>print-value</u>($x as element()) as  xs:string</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>print-name-value</u>($x as element()) as  xs:string?</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4>Function <pre class="prettyprint lang-xq" xml:space="preserve"><u>serialize</u>($x as element()) as  xs:string</pre></h4><h5>Comment</h5><p> Transforms an XML element into a JSON string representation.  See http://json.org.  Sample usage:    xquery version "1.0-ml";   import module namespace json="http://marklogic.com/json" at "json.xqy";   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)  Sample transformations:  Namespace URIs are ignored.  Namespace prefixes are included in the JSON name. Attributes are ignored, except for the special attribute </p>="true" that indicates the JSON serialization should write the node, even if single, as an array, and the attribute  that can be set to "boolean" or "number" to dictate the value should be written as that type (unquoted).  There's also an  attribute that when set to true writes the inner content as text rather than as structured JSON, useful for sending some XHTML over the wire. Text nodes within mixed content are ignored.  $x Element node to convert  String holding JSON serialized representation of $x 
    Author:  Jason Hunter 
    v. 1.0.1  Ported to xquery 1.0-ml; double escaped backslashes in json:escape<h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h3>Original Source Code</h3><pre class="prettyprint lang-xq" xml:space="preserve">xquery version "1.0-ml";


(:~
 : This is an example xquery file taken from several files to demonstrate xqdoc commenting
 : 
 : Sample usage:
 : &lt;b&gt;
 :   example bold tag
 : &lt;/b&gt;  
  : 
 : Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra 
 : eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse 
 : eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero. 
 : Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus
 : et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet. 
 :
 :
 : @author Jim Fuller
 : @version 1
 : 
 : 
:)

module namespace json = "http://marklogic.com/json";
declare namespace test="test";

declare default function namespace "http://www.w3.org/2005/xpath-functions";

declare variable $new-line-regex as xs:string := concat('[',codepoints-to-string((13, 10)),']+');

(: Need to backslash escape any double quotes, backslashes, newlines and tabs :)
declare function json:escape($s as xs:string) as xs:string {
  let $s := replace($s, "(\\|"")", "\\$1")
  let $s := replace($s, $new-line-regex, "\\n")
  let $s := replace($s, codepoints-to-string(9), "\\t")
  return $s
};

(: Print the thing that comes after the colon :)
declare function json:print-value($x as element()) as xs:string {
  if (count($x/*) = 0) then
    json:atomize($x)
  else if ($x/@quote = "true") then
    concat('"', json:escape(xdmp:quote($x/node())), '"')
  else
    string-join(('{',
      string-join(for $i in $x/* return json:print-name-value($i), ","),
    '}'), "")
};

(: Print the name and value both :)
declare function json:print-name-value($x as element()) as xs:string? {
  let $name := name($x)
  let $later-in-array := some $s in $x/following-sibling::* satisfies name($s) = $name
  return
  if ($later-in-array) then
    ()
  else 
    ()
};

(:~
 : Transforms an XML element into a JSON string representation.  See http://json.org.
 : 
 : Sample usage:
 : &lt;pre&gt;
 :   xquery version "1.0-ml";
 :   import module namespace json="http://marklogic.com/json" at "json.xqy";
 :   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)
 : &lt;/pre&gt;
 : Sample transformations:
 : 
 : Namespace URIs are ignored.  Namespace prefixes are included in the JSON name.
 :
 : Attributes are ignored, except for the special attribute @array="true" that
 : indicates the JSON serialization should write the node, even if single, as an
 : array, and the attribute @type that can be set to "boolean" or "number" to
 : dictate the value should be written as that type (unquoted).  There's also
 : an @quote attribute that when set to true writes the inner content as text
 : rather than as structured JSON, useful for sending some XHTML over the
 : wire.
 :
 : Text nodes within mixed content are ignored.
 :
 : @param $x Element node to convert
 : @return String holding JSON serialized representation of $x
 :
 : @author Jason Hunter
 : @version 1.0.1
 : 
 : Ported to xquery 1.0-ml; double escaped backslashes in json:escape
:)
declare function json:serialize($x as element())  as xs:string {
  string-join(('{', json:print-name-value($x), '}'), "")
};

</pre><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript" xml:space="preserve">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Generator" content="xquerydoc - https://github.com/xquery/xquerydoc"/><meta http-equiv="Authors" content="Copyright 2011 - John Snelson, James Fuller"/><title>xqDoc - </title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #000;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 90%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="lib/prettify.js" type="lib/javascript">  </script><script src="lib/lang-xq.js" type="text/javascript">  </script><link rel="stylesheet" type="text/css" href="lib/prettify.css"> </link></head><body class="home"><a href="index.html">XQuery API index</a><div id="main"><h1><span class="namespace">http://marklogic.com/json</span>  library module </h1><h5>Description</h5><p>This is an example xquery file taken from several files to demonstrate xqdoc commenting Sample usage:example bold tagProin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero. Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet.</p>
    Author:  Jim Fuller 
    v. 1  <div><h3>Variables</h3><ul><li>new-line-regexxs:string</li></ul></div><div><h3>Functions</h3><h4><pre class="prettyprint lang-xq"><u>Function:</u> escape($s as xs:string) as  xs:string</pre></h4><h5>Params</h5><ul><li>s:  xs:string</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> print-value($x as element()) as  xs:string</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> print-name-value($x as element()) as  xs:string?</pre></h4><h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> serialize($x as element()) as  xs:string</pre></h4><h5>Description</h5><p>Transforms an XML element into a JSON string representation. See http://json.org. Sample usage:xquery version "1.0-ml"; import module namespace json="http://marklogic.com/json" at "json.xqy"; json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)Sample transformations: Namespace URIs are ignored. Namespace prefixes are included in the JSON name. Attributes are ignored, except for the special attribute</p>="true" that indicates the JSON serialization should write the node, even if single, as an array, and the attribute  that can be set to "boolean" or "number" to dictate the value should be written as that type (unquoted).  There's also an  attribute that when set to true writes the inner content as text rather than as structured JSON, useful for sending some XHTML over the wire. Text nodes within mixed content are ignored. $x Element node to convert String holding JSON serialized representation of $x 
    Author:  Jason Hunter 
    v. 1.0.1  Ported to xquery 1.0-ml; double escaped backslashes in json:escape<h5>Params</h5><ul><li>x:  element()</li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul></div><div><h3>Original Source Code</h3><pre class="prettyprint lang-xq">xquery version "1.0-ml";


(:~
 : This is an example xquery file taken from several files to demonstrate xqdoc commenting
 : 
 : Sample usage:
 : &lt;b&gt;
 :   example bold tag
 : &lt;/b&gt;  
  : 
 : Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra 
 : eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse 
 : eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero. 
 : Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus
 : et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet. 
 :
 :
 : @author Jim Fuller
 : @version 1
 : 
 : 
:)

module namespace json = "http://marklogic.com/json";
declare namespace test="test";

declare default function namespace "http://www.w3.org/2005/xpath-functions";

declare variable $new-line-regex as xs:string := concat('[',codepoints-to-string((13, 10)),']+');

(: Need to backslash escape any double quotes, backslashes, newlines and tabs :)
declare function json:escape($s as xs:string) as xs:string {
  let $s := replace($s, "(\\|"")", "\\$1")
  let $s := replace($s, $new-line-regex, "\\n")
  let $s := replace($s, codepoints-to-string(9), "\\t")
  return $s
};

(: Print the thing that comes after the colon :)
declare function json:print-value($x as element()) as xs:string {
  if (count($x/*) = 0) then
    json:atomize($x)
  else if ($x/@quote = "true") then
    concat('"', json:escape(xdmp:quote($x/node())), '"')
  else
    string-join(('{',
      string-join(for $i in $x/* return json:print-name-value($i), ","),
    '}'), "")
};

(: Print the name and value both :)
declare function json:print-name-value($x as element()) as xs:string? {
  let $name := name($x)
  let $later-in-array := some $s in $x/following-sibling::* satisfies name($s) = $name
  return
  if ($later-in-array) then
    ()
  else 
    ()
};

(:~
 : Transforms an XML element into a JSON string representation.  See http://json.org.
 : 
 : Sample usage:
 : &lt;pre&gt;
 :   xquery version "1.0-ml";
 :   import module namespace json="http://marklogic.com/json" at "json.xqy";
 :   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;)
 : &lt;/pre&gt;
 : Sample transformations:
 : 
 : Namespace URIs are ignored.  Namespace prefixes are included in the JSON name.
 :
 : Attributes are ignored, except for the special attribute @array="true" that
 : indicates the JSON serialization should write the node, even if single, as an
 : array, and the attribute @type that can be set to "boolean" or "number" to
 : dictate the value should be written as that type (unquoted).  There's also
 : an @quote attribute that when set to true writes the inner content as text
 : rather than as structured JSON, useful for sending some XHTML over the
 : wire.
 :
 : Text nodes within mixed content are ignored.
 :
 : @param $x Element node to convert
 : @return String holding JSON serialized representation of $x
 :
 : @author Jason Hunter
 : @version 1.0.1
 : 
 : Ported to xquery 1.0-ml; double escaped backslashes in json:escape
:)
declare function json:serialize($x as element())  as xs:string {
  string-join(('{', json:print-name-value($x), '}'), "")
};

</pre></div><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td></tr></tbody></table></h3><br/></li></ol><h2> [ unit-test: /marklogic/simple.xqy ] [ example: /examples/json.xqy]<span style="font-size:75%;color:grey">simple</span></h2><ol class="results"><li class="result fail"><h3><input name="test" value="" type="checkbox"><b>ml1.</b></input><a href="?test=">default.xqy test<span class="namespace">ns: http://www.xqdoc.org/1.0</span></a><table><thead><th>expected  (/src/tests/expected/marklogic/json.xml)</th><th>actual </th></thead><tbody><tr><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><doc:xqdoc xmlns:doc="http://www.xqdoc.org/1.0"><doc:control><!--Generated by xquerydoc: http://github.com/xquery/xquerydoc--><doc:version>N/A</doc:version></doc:control><doc:module type="library"><doc:uri>http://marklogic.com/json</doc:uri><doc:comment><doc:description> This is an example xquery file taken from several files to demonstrate xqdoc commenting  Sample usage: <b>   example bold tag </b>    Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra  eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse  eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero.  Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet.  </doc:description><doc:author> Jim Fuller </doc:author><doc:version> 1  </doc:version></doc:comment></doc:module><doc:variables><doc:variable><doc:uri>new-line-regex</doc:uri><doc:type> xs:string</doc:type></doc:variable></doc:variables><doc:functions><doc:function><doc:name>escape</doc:name><doc:signature>($s as xs:string) as  xs:string</doc:signature><doc:parameters><doc:parameter><doc:name>s</doc:name><doc:type> xs:string</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> xs:string</doc:type></doc:return></doc:function><doc:function><doc:name>print-value</doc:name><doc:signature>($x as element()) as  xs:string</doc:signature><doc:parameters><doc:parameter><doc:name>x</doc:name><doc:type> element()</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> xs:string</doc:type></doc:return></doc:function><doc:function><doc:name>print-name-value</doc:name><doc:signature>($x as element()) as  xs:string?</doc:signature><doc:parameters><doc:parameter><doc:name>x</doc:name><doc:type> element()</doc:type></doc:parameter></doc:parameters><doc:return><doc:type occurrence="?"> xs:string</doc:type></doc:return></doc:function><doc:function><doc:comment><doc:description> Transforms an XML element into a JSON string representation.  See http://json.org.  Sample usage: <pre>   xquery version "1.0-ml";   import module namespace json="http://marklogic.com/json" at "json.xqy";   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;) </pre> Sample transformations:  Namespace URIs are ignored.  Namespace prefixes are included in the JSON name. Attributes are ignored, except for the special attribute </doc:description><doc:custom tag="array">="true" that indicates the JSON serialization should write the node, even if single, as an array, and the attribute </doc:custom><doc:custom tag="type"> that can be set to "boolean" or "number" to dictate the value should be written as that type (unquoted).  There's also an </doc:custom><doc:custom tag="quote"> attribute that when set to true writes the inner content as text rather than as structured JSON, useful for sending some XHTML over the wire. Text nodes within mixed content are ignored. </doc:custom><doc:param> $x Element node to convert </doc:param><doc:return> String holding JSON serialized representation of $x </doc:return><doc:author> Jason Hunter </doc:author><doc:version> 1.0.1  Ported to xquery 1.0-ml; double escaped backslashes in json:escape</doc:version></doc:comment><doc:name>serialize</doc:name><doc:signature>($x as element()) as  xs:string</doc:signature><doc:parameters><doc:parameter><doc:name>x</doc:name><doc:type> element()</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> xs:string</doc:type></doc:return></doc:function></doc:functions></doc:xqdoc></textarea></pre></td><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><doc:xqdoc xmlns:doc="http://www.xqdoc.org/1.0"><doc:control><!--Generated by xquerydoc: http://github.com/xquery/xquerydoc--><doc:date/><doc:version>N/A</doc:version></doc:control><doc:module type="library"><doc:uri>http://marklogic.com/json</doc:uri><doc:comment><doc:description> This is an example xquery file taken from several files to demonstrate xqdoc commenting  Sample usage: <b>   example bold tag </b>    Proin facilisis ultrices velit id bibendum. Curabitur eu nisi velit, vel pharetra  eros. Fusce eu metus sem. Etiam sed risus ultrices turpis blandit placerat. Suspendisse  eu massa arcu, eget feugiat arcu. Donec eget rutrum nisi. Vivamus eget massa libero.  Pellentesque placerat tortor elit. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed molestie odio lacinia eros iaculis laoreet.  </doc:description><doc:author> Jim Fuller </doc:author><doc:version> 1  </doc:version></doc:comment></doc:module><doc:variables><doc:variable><doc:uri>new-line-regex</doc:uri><doc:type> xs:string</doc:type></doc:variable></doc:variables><doc:functions><doc:function><doc:name>escape</doc:name><doc:signature>($s as xs:string) as  xs:string</doc:signature><doc:parameters><doc:parameter><doc:name>s</doc:name><doc:type> xs:string</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> xs:string</doc:type></doc:return></doc:function><doc:function><doc:name>print-value</doc:name><doc:signature>($x as element()) as  xs:string</doc:signature><doc:parameters><doc:parameter><doc:name>x</doc:name><doc:type> element()</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> xs:string</doc:type></doc:return></doc:function><doc:function><doc:name>print-name-value</doc:name><doc:signature>($x as element()) as  xs:string?</doc:signature><doc:parameters><doc:parameter><doc:name>x</doc:name><doc:type> element()</doc:type></doc:parameter></doc:parameters><doc:return><doc:type occurrence="?"> xs:string</doc:type></doc:return></doc:function><doc:function><doc:comment><doc:description> Transforms an XML element into a JSON string representation.  See http://json.org.  Sample usage: <pre>   xquery version "1.0-ml";   import module namespace json="http://marklogic.com/json" at "json.xqy";   json:serialize(&amp;lt;foo&amp;gt;&amp;lt;bar&amp;gt;kid&amp;lt;/bar&amp;gt;&amp;lt;/foo&amp;gt;) </pre> Sample transformations:  Namespace URIs are ignored.  Namespace prefixes are included in the JSON name. Attributes are ignored, except for the special attribute </doc:description><doc:custom tag="array">="true" that indicates the JSON serialization should write the node, even if single, as an array, and the attribute </doc:custom><doc:custom tag="type"> that can be set to "boolean" or "number" to dictate the value should be written as that type (unquoted).  There's also an </doc:custom><doc:custom tag="quote"> attribute that when set to true writes the inner content as text rather than as structured JSON, useful for sending some XHTML over the wire. Text nodes within mixed content are ignored. </doc:custom><doc:param> $x Element node to convert </doc:param><doc:return> String holding JSON serialized representation of $x </doc:return><doc:author> Jason Hunter </doc:author><doc:version> 1.0.1  Ported to xquery 1.0-ml; double escaped backslashes in json:escape</doc:version></doc:comment><doc:name>serialize</doc:name><doc:signature>($x as element()) as  xs:string</doc:signature><doc:parameters><doc:parameter><doc:name>x</doc:name><doc:type> element()</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> xs:string</doc:type></doc:return></doc:function></doc:functions></doc:xqdoc></textarea></pre></td></tr></tbody></table></h3><br/></li></ol><h2> [ unit-test: /marklogic/output-html.xqy ] [ example: /examples/default.xqy]<span style="font-size:75%;color:grey">Output HTML</span></h2><ol class="results"><li class="result fail"><h3><input name="test" value="" type="checkbox"><b>ml2.</b></input><a href="?test=">output-html manually<span class="namespace">ns: http://www.w3.org/1999/xhtml</span></a><table><thead><th>expected  (/src/tests/expected/marklogic/output-html.xml)</th><th>actual </th></thead><tbody><tr><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><title>xqDoc - </title><style type="text/css" xml:space="preserve">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #99f;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 50%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="src/tests/result/resource/prettify.js" type="text/javascript" xml:space="preserve">  </script><script src="src/tests/result/resource/lang-xq.js" type="text/javascript" xml:space="preserve">  </script><link rel="stylesheet" type="text/css" href="src/tests/result/resource/prettify.css"> </link></head><body class="home"><div id="main"><h1><span class="namespace"/>  main module </h1><h5>Comment</h5><p> &#xD;  This main module controls the presentation of the home page for&#xD;  xqDoc.  The home page will list all of the library and main modules&#xD;  contained in the 'xqDoc' collection.&#xD;  The mainline function invokes only the&#xD;  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;  real-time viewing.&#xD; &#xD;  </p>
    Author:  Darin McBeath&#xD;   June 9, 2006&#xD;  
    v. 1.3&#xD;<h3>Variables</h3><ul/><h3>Functions</h3><h3>Original Source Code</h3><pre class="prettyprint lang-xq" xml:space="preserve">xquery version "1.0" encoding "UTF-8";&#xD;
&#xD;
(:&#xD;
 : Copyright (c)2006 Elsevier, Inc.&#xD;
 :&#xD;
 : Licensed under the Apache License, Version 2.0 (the "License");&#xD;
 : you may not use this file except in compliance with the License.&#xD;
 : You may obtain a copy of the License at&#xD;
 :&#xD;
 : http://www.apache.org/licenses/LICENSE-2.0&#xD;
 :&#xD;
 : Unless required by applicable law or agreed to in writing, software&#xD;
 : distributed under the License is distributed on an "AS IS" BASIS,&#xD;
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&#xD;
 : See the License for the specific language governing permissions and&#xD;
 : limitations under the License.&#xD;
 :&#xD;
 : The use of the Apache License does not indicate that this project is&#xD;
 : affiliated with the Apache Software Foundation.&#xD;
 :)&#xD;
&#xD;
(:~ &#xD;
 :  This main module controls the presentation of the home page for&#xD;
 :  xqDoc.  The home page will list all of the library and main modules&#xD;
 :  contained in the 'xqDoc' collection.&#xD;
 :  The mainline function invokes only the&#xD;
 :  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;
 :  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;
 :  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;
 :  real-time viewing.&#xD;
 : &#xD;
 :  @author Darin McBeath&#xD;
 :  @since June 9, 2006&#xD;
 :  @version 1.3&#xD;
 :)&#xD;
&#xD;
import module namespace display="xqdoc/xqdoc-display" at "xqdoc-display.xqy";&#xD;
&#xD;
&#xD;
(: Disable caching and set content type :)&#xD;
xdmp:set-response-content-type("text/html"),&#xD;
xdmp:add-response-header("Pragma", "no-cache"),&#xD;
xdmp:add-response-header("Cache-Control", "no-cache"),&#xD;
xdmp:add-response-header("Expires", "0"),&#xD;
&#xD;
display:get-default-html(false()) &#xD;
&#xD;
</pre><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript" xml:space="preserve">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Generator" content="xquerydoc - https://github.com/xquery/xquerydoc"/><meta http-equiv="Authors" content="Copyright 2011 - John Snelson, James Fuller"/><title>xqDoc - </title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #000;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 90%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="lib/prettify.js" type="lib/javascript">  </script><script src="lib/lang-xq.js" type="text/javascript">  </script><link rel="stylesheet" type="text/css" href="lib/prettify.css"> </link></head><body class="home"><a href="index.html">XQuery API index</a><div id="main"><h1><span class="namespace"/>  main module </h1><h5>Description</h5><p>This main module controls the presentation of the home page for xqDoc. The home page will list all of the library and main modules contained in the 'xqDoc' collection. The mainline function invokes only the method to generate the HTML for the xqDoc home page. A parameter of type xs:boolean is passed to indicate whether links on the page should be constructed to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic real-time viewing.</p>
    Author:  Darin McBeath&#xD;   June 9, 2006&#xD;  
    v. 1.3&#xD;<div><h3>Variables</h3><ul/></div><div><h3>Functions</h3></div><div><h3>Original Source Code</h3><pre class="prettyprint lang-xq">xquery version "1.0" encoding "UTF-8";&#xD;
&#xD;
(:&#xD;
 : Copyright (c)2006 Elsevier, Inc.&#xD;
 :&#xD;
 : Licensed under the Apache License, Version 2.0 (the "License");&#xD;
 : you may not use this file except in compliance with the License.&#xD;
 : You may obtain a copy of the License at&#xD;
 :&#xD;
 : http://www.apache.org/licenses/LICENSE-2.0&#xD;
 :&#xD;
 : Unless required by applicable law or agreed to in writing, software&#xD;
 : distributed under the License is distributed on an "AS IS" BASIS,&#xD;
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&#xD;
 : See the License for the specific language governing permissions and&#xD;
 : limitations under the License.&#xD;
 :&#xD;
 : The use of the Apache License does not indicate that this project is&#xD;
 : affiliated with the Apache Software Foundation.&#xD;
 :)&#xD;
&#xD;
(:~ &#xD;
 :  This main module controls the presentation of the home page for&#xD;
 :  xqDoc.  The home page will list all of the library and main modules&#xD;
 :  contained in the 'xqDoc' collection.&#xD;
 :  The mainline function invokes only the&#xD;
 :  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;
 :  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;
 :  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;
 :  real-time viewing.&#xD;
 : &#xD;
 :  @author Darin McBeath&#xD;
 :  @since June 9, 2006&#xD;
 :  @version 1.3&#xD;
 :)&#xD;
&#xD;
import module namespace display="xqdoc/xqdoc-display" at "xqdoc-display.xqy";&#xD;
&#xD;
&#xD;
(: Disable caching and set content type :)&#xD;
xdmp:set-response-content-type("text/html"),&#xD;
xdmp:add-response-header("Pragma", "no-cache"),&#xD;
xdmp:add-response-header("Cache-Control", "no-cache"),&#xD;
xdmp:add-response-header("Expires", "0"),&#xD;
&#xD;
display:get-default-html(false()) &#xD;
&#xD;
</pre></div><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td></tr></tbody></table></h3><br/></li><li class="result fail"><h3><input name="test" value="" type="checkbox"><b>ml3.</b></input><a href="?test=">output-html with xqdoc:generate-docs<span class="namespace">ns: http://www.w3.org/1999/xhtml</span></a><table><thead><th>expected  (/src/tests/expected/marklogic/output-html.xml)</th><th>actual </th></thead><tbody><tr><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><title>xqDoc - </title><style type="text/css" xml:space="preserve">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #99f;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 50%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="src/tests/result/resource/prettify.js" type="text/javascript" xml:space="preserve">  </script><script src="src/tests/result/resource/lang-xq.js" type="text/javascript" xml:space="preserve">  </script><link rel="stylesheet" type="text/css" href="src/tests/result/resource/prettify.css"> </link></head><body class="home"><div id="main"><h1><span class="namespace"/>  main module </h1><h5>Comment</h5><p> &#xD;  This main module controls the presentation of the home page for&#xD;  xqDoc.  The home page will list all of the library and main modules&#xD;  contained in the 'xqDoc' collection.&#xD;  The mainline function invokes only the&#xD;  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;  real-time viewing.&#xD; &#xD;  </p>
    Author:  Darin McBeath&#xD;   June 9, 2006&#xD;  
    v. 1.3&#xD;<h3>Variables</h3><ul/><h3>Functions</h3><h3>Original Source Code</h3><pre class="prettyprint lang-xq" xml:space="preserve">xquery version "1.0" encoding "UTF-8";&#xD;
&#xD;
(:&#xD;
 : Copyright (c)2006 Elsevier, Inc.&#xD;
 :&#xD;
 : Licensed under the Apache License, Version 2.0 (the "License");&#xD;
 : you may not use this file except in compliance with the License.&#xD;
 : You may obtain a copy of the License at&#xD;
 :&#xD;
 : http://www.apache.org/licenses/LICENSE-2.0&#xD;
 :&#xD;
 : Unless required by applicable law or agreed to in writing, software&#xD;
 : distributed under the License is distributed on an "AS IS" BASIS,&#xD;
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&#xD;
 : See the License for the specific language governing permissions and&#xD;
 : limitations under the License.&#xD;
 :&#xD;
 : The use of the Apache License does not indicate that this project is&#xD;
 : affiliated with the Apache Software Foundation.&#xD;
 :)&#xD;
&#xD;
(:~ &#xD;
 :  This main module controls the presentation of the home page for&#xD;
 :  xqDoc.  The home page will list all of the library and main modules&#xD;
 :  contained in the 'xqDoc' collection.&#xD;
 :  The mainline function invokes only the&#xD;
 :  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;
 :  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;
 :  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;
 :  real-time viewing.&#xD;
 : &#xD;
 :  @author Darin McBeath&#xD;
 :  @since June 9, 2006&#xD;
 :  @version 1.3&#xD;
 :)&#xD;
&#xD;
import module namespace display="xqdoc/xqdoc-display" at "xqdoc-display.xqy";&#xD;
&#xD;
&#xD;
(: Disable caching and set content type :)&#xD;
xdmp:set-response-content-type("text/html"),&#xD;
xdmp:add-response-header("Pragma", "no-cache"),&#xD;
xdmp:add-response-header("Cache-Control", "no-cache"),&#xD;
xdmp:add-response-header("Expires", "0"),&#xD;
&#xD;
display:get-default-html(false()) &#xD;
&#xD;
</pre><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript" xml:space="preserve">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td><td><pre style="border: 1px solid #888;padding: 2px"><textarea rows="5" cols="60"><html xmlns="http://www.w3.org/1999/xhtml" version="-//W3C//DTD XHTML 1.1//EN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Generator" content="xquerydoc - https://github.com/xquery/xquerydoc"/><meta http-equiv="Authors" content="Copyright 2011 - John Snelson, James Fuller"/><title>xqDoc - </title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #000;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 90%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="lib/prettify.js" type="lib/javascript">  </script><script src="lib/lang-xq.js" type="text/javascript">  </script><link rel="stylesheet" type="text/css" href="lib/prettify.css"> </link></head><body class="home"><a href="index.html">XQuery API index</a><div id="main"><h1><span class="namespace"/>  main module </h1><h5>Description</h5><p>This main module controls the presentation of the home page for xqDoc. The home page will list all of the library and main modules contained in the 'xqDoc' collection. The mainline function invokes only the method to generate the HTML for the xqDoc home page. A parameter of type xs:boolean is passed to indicate whether links on the page should be constructed to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic real-time viewing.</p>
    Author:  Darin McBeath&#xD;   June 9, 2006&#xD;  
    v. 1.3&#xD;<div><h3>Variables</h3><ul/></div><div><h3>Functions</h3></div><div><h3>Original Source Code</h3><pre class="prettyprint lang-xq">xquery version "1.0" encoding "UTF-8";&#xD;
&#xD;
(:&#xD;
 : Copyright (c)2006 Elsevier, Inc.&#xD;
 :&#xD;
 : Licensed under the Apache License, Version 2.0 (the "License");&#xD;
 : you may not use this file except in compliance with the License.&#xD;
 : You may obtain a copy of the License at&#xD;
 :&#xD;
 : http://www.apache.org/licenses/LICENSE-2.0&#xD;
 :&#xD;
 : Unless required by applicable law or agreed to in writing, software&#xD;
 : distributed under the License is distributed on an "AS IS" BASIS,&#xD;
 : WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&#xD;
 : See the License for the specific language governing permissions and&#xD;
 : limitations under the License.&#xD;
 :&#xD;
 : The use of the Apache License does not indicate that this project is&#xD;
 : affiliated with the Apache Software Foundation.&#xD;
 :)&#xD;
&#xD;
(:~ &#xD;
 :  This main module controls the presentation of the home page for&#xD;
 :  xqDoc.  The home page will list all of the library and main modules&#xD;
 :  contained in the 'xqDoc' collection.&#xD;
 :  The mainline function invokes only the&#xD;
 :  method to generate the HTML for the xqDoc home page.  A parameter of type &#xD;
 :  xs:boolean is passed to indicate whether links on the page should be constructed &#xD;
 :  to static HTML pages (for off-line viewing) or to XQuery scripts for dynamic&#xD;
 :  real-time viewing.&#xD;
 : &#xD;
 :  @author Darin McBeath&#xD;
 :  @since June 9, 2006&#xD;
 :  @version 1.3&#xD;
 :)&#xD;
&#xD;
import module namespace display="xqdoc/xqdoc-display" at "xqdoc-display.xqy";&#xD;
&#xD;
&#xD;
(: Disable caching and set content type :)&#xD;
xdmp:set-response-content-type("text/html"),&#xD;
xdmp:add-response-header("Pragma", "no-cache"),&#xD;
xdmp:add-response-header("Cache-Control", "no-cache"),&#xD;
xdmp:add-response-header("Expires", "0"),&#xD;
&#xD;
display:get-default-html(false()) &#xD;
&#xD;
</pre></div><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html></textarea></pre></td></tr></tbody></table></h3><br/></li></ol><br/><br/><div class="footer"><p style="text-align:right"><i>2011-09-18T19:39:00.779+02:00</i></p></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html>